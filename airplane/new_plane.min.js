var canvas=document.getElementsByTagName("canvas")[0];var ctx=canvas.getContext("2d");const START=0;const LOADING=1;const PLAY=2;const PAUSE=3;const OVER=4;function Arrays(a){for(var d=0,c=[];d<a.length;d++){var b=new Image();b.src="./images/"+a[d];c.push(b)}return c}var state=START;var bg=new Image();bg.src="./images/background.png";var Background={imgs:bg,width:480,height:650};var game=new Game(Background);var logo=new Image;logo.src="./images/start.png";function Game(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.y1=0;this.y2=-this.height;this.draw=function(b){b.drawImage(this.imgs,0,this.y1);b.drawImage(this.imgs,0,this.y2)};this.step=function(){this.y1+=2;this.y2+=2;if(this.y1>this.height){this.y1=-this.height}if(this.y2>this.height){this.y2=-this.height}}}canvas.onclick=function(){if(state==START){state=LOADING}else{if(state==OVER){window.location.reload()}}};var loading={imgs:Arrays(["game_loading1.png","game_loading2.png","game_loading3.png"])};var gameloading=new Loading(loading);function Loading(a){this.imgs=a.imgs;this.begin=0;this.draw=function(b){if(this.begin<3){b.drawImage(this.imgs[0],0,600)}else{if(this.begin<6){b.drawImage(this.imgs[1],0,600)}else{if(this.begin<9){b.drawImage(this.imgs[2],0,600)}else{if(this.begin<11){state=PLAY}}}}this.begin++}}var playing={x:canvas.width/2-99/2,y:canvas.height-124,imgs:Arrays(["hero1.png","hero2.png"]),width:99,height:124,Playnum:0,life:4};function Play(a){this.x=a.x;this.y=a.y;this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.Playnum=a.Playnum;this.time=0;this.destroy_flag=0;this.life=a.life;this.draw=function(b){b.drawImage(this.imgs[this.Playnum],this.x,this.y)};this.step=function(){this.Playnum++;this.Playnum=this.Playnum%2};this.heroOver=function(b){b.font="30px '微软雅黑'";b.fillText("life "+this.life,400,30);if(this.life<=0){state=OVER}};this.stepBullets=function(c){if(this.time%25==0){var b=new create_bullet(BULLET);b.x=this.x+this.width/2-9/2;b.y=this.y;c[c.length]=b}this.time++}}var Plays=new Play(playing);canvas.onmousemove=function(a){overing.x=Plays.x=a.offsetX-Plays.width/2;overing.y=Plays.y=a.offsetY-Plays.height/2};var bullet_img=new Image();bullet_img.src="./images/bullet.png";var BULLET={width:9,height:21,imgs:bullet_img,destroy_flag:0};function create_bullet(a){this.width=a.width;this.height=a.height;this.imgs=a.imgs;this.x=a.x;this.y=a.y;this.destroy_flag=a.destroy_flag;this.draw=function(b){b.drawImage(this.imgs,this.x,this.y)};this.step=function(){this.y--;if(this.y<(0-this.height)){this.destroy_flag=1}}}var bullets=[];function bullets_animate(){for(var a=0;a<bullets.length;a++){bullets[a].draw(ctx);bullets[a].step()}}function bullets_destroy(){for(var a=0;a<bullets.length;a++){if(bullets[a].destroy_flag==1){bullets.splice(a,1)}}}var enemys=[];var enemys1=[];var enemys2=[];var ENEMY_MIN={imgs:Arrays(["enemy1.png","enemy1_down1.png","enemy1_down2.png","enemy1_down3.png","enemy1_down4.png","game_loading4.png"]),width:57,height:51,index:0,destroy_flag:0,is_down:0,life:1,planeType:1};var ENEMY_MIDDLE={imgs:Arrays(["enemy2.png","enemy2_down1.png","enemy2_down2.png","enemy2_down3.png","enemy2_down4.png"]),width:69,height:95,index:0,destroy_flag:0,is_down:0,life:2,planeType:2};var ENEMY_MAX={imgs:Arrays(["enemy3_n2.png","enemy3_down1.png","enemy3_down2.png","enemy3_down3.png","enemy3_down4.png","enemy3_down5.png","enemy3_down6.png"]),width:165,height:261,index:0,destroy_flag:0,is_down:0,life:4,planeType:3};function create_e_min(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.index=a.index;this.destroy_flag=a.destroy_flag;this.is_down=a.is_down;this.life=a.life;this.down_time=0;this.x=parseInt(Math.random()*(canvas.width-this.width+1));this.y=-this.height;this.draw=function(b){b.drawImage(this.imgs[this.index],this.x,this.y)};this.step=function(){this.y++;if(this.y>canvas.height){this.destroy_flag=1}};this.down=function(){if(this.life<=0){this.down_time++;if(this.down_time%2==0){this.index++}if(this.index>=this.imgs.length){this.destroy_flag=1;this.index=0}}}}var score=0;function enemy_animation(a){for(var b=0;b<a.length;b++){if(a[b].is_down==0&&a[b].destroy_flag==0){a[b].draw(ctx);a[b].step()}else{if(a[b].is_down==1&&a[b].destroy_flag==0){a[b].down();a[b].draw(ctx);a[b].step()}else{if(a[b].destroy_flag==1){if(a[b].width==57){score+=1}else{if(a[b].width==69){score+=2}else{if(a[b].width==165){score+=3}}}a.splice(b,1);b--}}}}}function is_e_hitted(b){for(var c=0;c<b.length;c++){for(var a=0;a<bullets.length;a++){if(((bullets[a].x+9)>=b[c].x)&&(bullets[a].x<=b[c].x+b[c].width)&&(bullets[a].y<=b[c].y+b[c].height)){b[c].is_down=1;b[c].life--;bullets[a].destroy_flag=1}if((Plays.x+Plays.width>b[c].x)&&(Plays.x<b[c].x+b[c].width)&&(Plays.y+Plays.height>b[c].y)&&(Plays.y<b[c].y+b[c].height)){b.splice(c,1);Plays.life--}}}}var score1=[];var life1=[];var get_score={imgs:Arrays(["24.ico"]),width:24,height:24,destroy_flag:0};var get_life={imgs:Arrays(["favicon2.ico"]),width:16,height:16,destroy_flag:0};function get_more(a){this.imgs=a.imgs;this.width=a.width;this.height=a.height;this.destroy_flag=a.destroy_flag;this.x=parseInt(Math.random()*(canvas.width-this.width+1));this.y=-this.height;this.draw=function(b){b.drawImage(this.imgs[0],this.x,this.y)};this.step=function(){this.y++;if(this.y>canvas.height){this.destroy_flag=1}}}function get_more_animation(b){for(var a=0;a<b.length;a++){b[a].draw(ctx);b[a].step()}}function enter_more(b){for(var a=0;a<b.length;a++){if((Plays.x+Plays.width>b[a].x)&&(Plays.x<b[a].x+b[a].width)&&(Plays.y+Plays.height>b[a].y)&&(Plays.y<b[a].y+b[a].height)){if(b[a].width==16){Plays.life++}else{if(b[a].width==24){score+=100}}b.splice(a,1)}}}var pauseImg=new Image();pauseImg.src="./images/game_pause_nor.png";canvas.onmouseout=function(){if(state==PLAY){state=PAUSE}};canvas.onmouseover=function(){if(state==PAUSE){state=PLAY}};var over={x:canvas.width/2-99/2,y:canvas.height-124,imgs:Arrays(["hero_blowup_n1.png","hero_blowup_n2.png","hero_blowup_n3.png","hero_blowup_n4.png"]),width:99,height:124,Playnum:0};function over_animate(a){this.imgs=a.imgs;this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height;this.Playnum=a.Playnum;this.Playtime=0;this.draw=function(b){b.drawImage(this.imgs[this.Playnum],this.x,this.y)};this.step=function(){this.Playtime++;if(this.Playtime%5==0){this.Playnum++}if(this.Playnum>=this.imgs.length){this.Playnum=this.imgs.length-1}}}var overing=new over_animate(over);var times=0;setInterval(function(){game.draw(ctx);game.step();switch(state){case START:ctx.drawImage(logo,40,0);break;case LOADING:gameloading.draw(ctx);break;case PLAY:Plays.draw(ctx);Plays.step();Plays.heroOver(ctx);Plays.stepBullets(bullets);bullets_animate();bullets_destroy();times++;if(times%50==0){var b=new create_e_min(ENEMY_MIN);enemys[enemys.length]=b}is_e_hitted(enemys);enemy_animation(enemys);if(times>800&&times%240==0){var d=new create_e_min(ENEMY_MIDDLE);enemys1[enemys1.length]=d}is_e_hitted(enemys1);enemy_animation(enemys1);if(times>2000&&times%550==0){var c=new create_e_min(ENEMY_MAX);enemys2[enemys2.length]=c}is_e_hitted(enemys2);enemy_animation(enemys2);if(times>1000&&times%2000==0){var e=new get_more(get_score);score1[score1.length]=e}enter_more(score1);get_more_animation(score1);if(times>2000&&times%5000==0){var a=new get_more(get_life);life1[life1.length]=a}enter_more(life1);get_more_animation(life1);ctx.font="30px '微软雅黑'";ctx.fillText("score "+score,10,30);break;case PAUSE:ctx.drawImage(pauseImg,210,305);break;case OVER:overing.draw(ctx);overing.step();ctx.font="60px '微软雅黑'";ctx.fillStyle="red";ctx.fillText("游戏结束",120,305);break}},10);